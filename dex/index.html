<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Distordia DEX - UX for the Nexus blockchain decentralized exchange">
    <title>Distordia DEX | Nexus Marketplace</title>
    <link rel="icon" type="image/png" href="../images/logo-utentekst.png">
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="dex.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.1/dist/chartjs-chart-financial.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="logo">
                <a href="../index.html" style="display: flex; align-items: center; gap: 0.8rem; text-decoration: none;">
                    <img src="../images/logo-utentekst.png" alt="Distordia Logo" class="logo-img">
                    <span class="logo-text">DISTORDIA</span>
                </a>
            </div>
            <ul class="nav-links">
                <li><a href="../index.html">Home</a></li>
                <li><a href="../index.html#about">About</a></li>
                <li class="dropdown">
                    <a href="#">dApps ‚ñæ</a>
                    <div class="dropdown-menu">
                        <a href="index.html" class="dropdown-item active">DEX</a>
                        <a href="../masterdata/index.html" class="dropdown-item">Master Data</a>
                        <a href="../q-wallet/index.html" class="dropdown-item">Q-Wallet Plugin</a>
                        <div class="dropdown-divider"></div>
                        <span class="dropdown-header">Projects</span>
                        <a href="../swap/index.html" class="dropdown-item">Stablecoin Bridge</a>
                        <a href="../content-verification/index.html" class="dropdown-item">Content Verification</a>
                        <a href="../social/index.html" class="dropdown-item">Social</a>
                        <a href="https://github.com/AkstonCap/swapService" target="_blank" class="dropdown-item">swapService</a>
                        <a href="https://github.com/AkstonCap/q-mobile" target="_blank" class="dropdown-item">q-mobile</a>
                    </div>
                </li>
                <li class="dropdown">
                    <a href="#">Modules ‚ñæ</a>
                    <div class="dropdown-menu">
                        <a href="https://github.com/AkstonCap/NexGo" target="_blank" class="dropdown-item">NexGo Module</a>
                        <a href="https://github.com/AkstonCap/DEX" target="_blank" class="dropdown-item">DEX Module</a>
                        <a href="https://github.com/AkstonCap/verificationModule" target="_blank" class="dropdown-item">Verification Module</a>
                    </div>
                </li>
                <li><a href="../standards/index.html">Standards</a></li>
                <li><a href="../index.html#contact">Contact</a></li>
            </ul>
            <div class="auth-controls">
                <button id="connectWalletBtn" class="connect-wallet-btn">Connect Wallet</button>
                <div id="walletInfo" class="wallet-info" style="display: none;">
                    <span id="walletAddress" class="wallet-address"></span>
                    <button id="disconnectBtn" class="disconnect-btn">Disconnect</button>
                </div>
            </div>
            <div class="menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Trading Interface -->
    <section class="trading-section">
        <div class="container-fluid">
            <div class="trading-grid">
                <!-- Market Pairs List -->
                <div class="market-pairs-panel">
                    <div class="panel-header">
                        <h3>Market Pairs</h3>
                        <div class="search-box">
                            <input type="text" id="pair-search" placeholder="Search pairs...">
                        </div>
                    </div>
                    <div class="pairs-tabs">
                        <button class="tab-btn active" data-filter="all">All</button>
                        <button class="tab-btn" data-filter="nxs">NXS</button>
                        <button class="tab-btn" data-filter="usdd">USDD</button>
                        <button class="tab-btn" data-filter="favorites">‚òÖ</button>
                    </div>
                    <div class="pairs-list" id="pairs-list">
                        <!-- Market pairs will be loaded here -->
                        <div class="loading-spinner">Loading markets...</div>
                    </div>
                </div>

                <!-- Chart and Trading Panel Container -->
                <div class="chart-trade-container">
                    <!-- Trading Chart -->
                    <div class="chart-panel">
                        <div class="panel-header">
                            <div class="current-pair">
                                <h2 id="current-pair-name">Select a trading pair</h2>
                                <div class="pair-stats">
                                    <span class="current-price" id="current-price">-</span>
                                    <span class="price-change" id="price-change">-</span>
                                </div>
                            </div>
                            <div class="chart-controls">
                                <button class="chart-interval" data-interval="1d">1D</button>
                                <button class="chart-interval" data-interval="1w">1W</button>
                                <button class="chart-interval" data-interval="1m">1M</button>
                                <button class="chart-interval active" data-interval="1y">1Y</button>
                                <div class="chart-divider"></div>
                                <div class="chart-toggle-group" id="candle-size-group">
                                    <button class="chart-toggle-btn" data-value="small" title="Smaller candles">
                                        <span class="toggle-label" id="candle-small-label">1d</span>
                                    </button>
                                    <button class="chart-toggle-btn active" data-value="large" title="Larger candles">
                                        <span class="toggle-label" id="candle-large-label">1w</span>
                                    </button>
                                </div>
                                <div class="chart-divider"></div>
                                <div class="chart-toggle-group" id="chart-type-group">
                                    <button class="chart-toggle-btn" data-value="line" title="Line Chart">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="22 12 18 8 13 13 9 9 2 16"></polyline>
                                        </svg>
                                    </button>
                                    <button class="chart-toggle-btn active" data-value="candlestick" title="Candlestick Chart">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="9" y1="2" x2="9" y2="6"></line>
                                            <rect x="6" y="6" width="6" height="10" rx="1" fill="currentColor"></rect>
                                            <line x1="9" y1="16" x2="9" y2="22"></line>
                                            <line x1="17" y1="4" x2="17" y2="8"></line>
                                            <rect x="14" y="8" width="6" height="8" rx="1"></rect>
                                            <line x1="17" y1="16" x2="17" y2="20"></line>
                                        </svg>
                                    </button>
                                </div>
                                <div class="chart-toggle-group" id="scale-toggle-group">
                                    <button class="chart-toggle-btn" data-value="linear" title="Linear Scale">
                                        <span class="toggle-label">Lin</span>
                                    </button>
                                    <button class="chart-toggle-btn active" data-value="logarithmic" title="Logarithmic Scale">
                                        <span class="toggle-label">Log</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="price-chart"></canvas>
                        </div>
                    </div>

                    <!-- Inline Trading Panel -->
                    <div class="trading-panel" id="trading-panel">
                        <!-- Wallet Not Connected Overlay -->
                        <div class="trading-panel-overlay" id="trading-panel-overlay">
                            <div class="overlay-content">
                                <span class="lock-icon">üîí</span>
                                <p>Connect your wallet to start trading</p>
                                <button class="overlay-connect-btn" id="overlay-connect-btn">Connect Wallet</button>
                            </div>
                        </div>

                        <!-- Trading Panel Content -->
                        <div class="trading-panel-content">
                            <!-- Order Type Tabs -->
                            <div class="order-type-tabs">
                                <button class="order-type-tab active" data-type="fill">Fill Orders</button>
                                <button class="order-type-tab" data-type="create">Create Order</button>
                            </div>

                            <!-- Fill Orders Mode -->
                            <div class="trade-mode fill-mode" id="fill-mode">
                                <div class="fill-instructions">
                                    <p>üìã Click on orders in the order book to select them for execution.</p>
                                    <p class="note">Orders must be executed in full - no partial fills.</p>
                                </div>

                                <!-- Selected Orders List -->
                                <div class="selected-orders" id="selected-orders">
                                    <div class="selected-orders-header">
                                        <span>Selected Orders</span>
                                        <button type="button" class="clear-selection-btn" id="clear-selection-btn">Clear All</button>
                                    </div>
                                    <div class="selected-orders-list" id="selected-orders-list">
                                        <div class="no-orders-selected">No orders selected</div>
                                    </div>
                                </div>

                                <!-- Fill Summary -->
                                <div class="fill-summary" id="fill-summary" style="display: none;">
                                    <div class="summary-row">
                                        <span>Orders to fill:</span>
                                        <span id="fill-order-count">0</span>
                                    </div>
                                    <div class="summary-row">
                                        <span>Total Amount:</span>
                                        <span><span id="fill-total-amount">0</span> <span id="fill-amount-token">-</span></span>
                                    </div>
                                    <div class="summary-row">
                                        <span>Total Cost:</span>
                                        <span><span id="fill-total-cost">0</span> <span id="fill-cost-token">-</span></span>
                                    </div>
                                    <div class="summary-row">
                                        <span>Avg. Price:</span>
                                        <span id="fill-avg-price">-</span>
                                    </div>
                                    <div class="summary-row fee-row">
                                        <span>Network Fee:</span>
                                        <span id="fill-fee-estimate">Free for 1 order</span>
                                    </div>
                                </div>

                                <!-- Account Selection -->
                                <div class="account-selection" id="account-selection" style="display: none;">
                                    <div class="form-row">
                                        <label>Payment Account (From)</label>
                                        <select id="from-account" class="account-select">
                                            <option value="">Select payment account...</option>
                                            <option value="default">default</option>
                                        </select>
                                    </div>
                                    <div class="form-row">
                                        <label>Receiving Account (To)</label>
                                        <select id="to-account" class="account-select">
                                            <option value="">Select receiving account...</option>
                                            <option value="default">default</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Fill Button -->
                                <button type="button" class="submit-trade-btn buy" id="fill-orders-btn" disabled>
                                    <span class="btn-text">Select Orders to Fill</span>
                                </button>
                            </div>

                            <!-- Create Order Mode -->
                            <div class="trade-mode create-mode" id="create-mode" style="display: none;">
                                <!-- Buy/Sell Toggle -->
                                <div class="trade-side-toggle">
                                    <button class="trade-side-btn buy active" data-side="bid">Place Bid</button>
                                    <button class="trade-side-btn sell" data-side="ask">Place Ask</button>
                                </div>

                                <!-- Balance Display -->
                                <div class="balance-display">
                                    <div class="balance-item">
                                        <span class="balance-label">Available:</span>
                                        <span class="balance-value" id="available-balance">-</span>
                                        <span class="balance-token" id="balance-token">-</span>
                                    </div>
                                </div>

                                <!-- Create Order Form -->
                                <div class="inline-trade-form">
                                    <!-- Price Input -->
                                    <div class="form-row">
                                        <label>Price</label>
                                        <div class="input-with-buttons">
                                            <button type="button" class="quick-price-btn" id="best-bid-btn" title="Best Bid">Bid</button>
                                            <input type="number" id="inline-price" placeholder="0.00" step="0.00000001" min="0">
                                            <button type="button" class="quick-price-btn" id="best-ask-btn" title="Best Ask">Ask</button>
                                            <span class="input-suffix" id="price-suffix">USDD</span>
                                        </div>
                                    </div>

                                    <!-- Amount Input -->
                                    <div class="form-row">
                                        <label>Amount</label>
                                        <div class="input-with-suffix">
                                            <input type="number" id="inline-amount" placeholder="0.00" step="0.000001" min="0">
                                            <span class="input-suffix" id="amount-suffix">NXS</span>
                                        </div>
                                        <div class="quick-amount-buttons">
                                            <button type="button" class="quick-amount-btn" data-percent="25">25%</button>
                                            <button type="button" class="quick-amount-btn" data-percent="50">50%</button>
                                            <button type="button" class="quick-amount-btn" data-percent="75">75%</button>
                                            <button type="button" class="quick-amount-btn" data-percent="100">100%</button>
                                        </div>
                                    </div>

                                    <!-- Total Display -->
                                    <div class="form-row total-row">
                                        <label>Total</label>
                                        <div class="total-display">
                                            <span id="inline-total">0.00</span>
                                            <span id="total-suffix">USDD</span>
                                        </div>
                                    </div>

                                    <!-- Order Preview -->
                                    <div class="order-preview">
                                        <div class="preview-row">
                                            <span>Network Fee:</span>
                                            <span>Free (single order)</span>
                                        </div>
                                        <div class="preview-row">
                                            <span>Type:</span>
                                            <span id="order-type-display">Limit Bid</span>
                                        </div>
                                    </div>

                                    <!-- Submit Button -->
                                    <button type="button" class="submit-trade-btn buy" id="create-order-btn">
                                        <span class="btn-text">Place Bid Order</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Error Display -->
                            <div class="inline-trade-error" id="inline-trade-error" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Order Book -->
                <div class="orderbook-panel">
                    <div class="panel-header">
                        <h3>Order Book</h3>
                        <div class="orderbook-controls">
                            <button class="orderbook-view active" data-view="both">
                                <span class="icon">üìä</span>
                            </button>
                            <button class="orderbook-view" data-view="asks">
                                <span class="icon">üìà</span>
                            </button>
                            <button class="orderbook-view" data-view="bids">
                                <span class="icon">üìâ</span>
                            </button>
                        </div>
                    </div>
                    <div class="orderbook-content">
                        <div class="orderbook-header">
                            <span>Price</span>
                            <span>Amount</span>
                            <span>Total</span>
                        </div>
                        <div class="orderbook-asks" id="orderbook-asks">
                            <!-- Asks will be loaded here -->
                        </div>
                        <div class="orderbook-spread">
                            <span class="spread-label">Spread:</span>
                            <span class="spread-value" id="spread-value">-</span>
                        </div>
                        <div class="orderbook-bids" id="orderbook-bids">
                            <!-- Bids will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Recent Trades -->
    <section class="trades-section">
        <div class="container">
            <div class="panel-header">
                <h3>Recent Trades</h3>
                <div class="trade-filters">
                    <button class="filter-btn active" data-filter="all">All Trades</button>
                    <button class="filter-btn" data-filter="buys">Buys</button>
                    <button class="filter-btn" data-filter="sells">Sells</button>
                </div>
            </div>
            <div class="trades-table-container">
                <table class="trades-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Pair</th>
                            <th>Type</th>
                            <th>Price</th>
                            <th>Amount</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="trades-list">
                        <tr>
                            <td colspan="6" class="loading-cell">Loading recent trades...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Market Overview -->
    <section class="market-overview">
        <div class="container">
            <h2 class="section-title">Market Overview</h2>
            <div class="markets-grid" id="markets-grid">
                <!-- Market cards will be loaded here -->
                <div class="loading-spinner">Loading market data...</div>
            </div>
        </div>
    </section>

    <!-- API Status -->
    <section class="api-status">
        <div class="container">
            <div class="status-card">
                <div class="status-indicator">
                    <span class="status-dot" id="api-status-dot"></span>
                    <span class="status-text" id="api-status-text">Connecting to Nexus.io...</span>
                </div>
                <div class="status-details">
                    <span>Last Update: <span id="last-update">-</span></span>
                    <span>Block Height: <span id="status-block-height">-</span></span>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="../images/logo-utentekst.png" alt="Distordia Logo" class="footer-logo-img">
                    <span class="footer-logo-text">DISTORDIA</span>
                </div>
                <p>&copy; 2025 Distordia Labs. All rights reserved.</p>
                <p class="disclaimer">This DEX interface displays real-time market data from Nexus.io blockchain. No data is stored on this website or any centralized servers.</p>
            </div>
        </div>
    </footer>

    <!-- Trade Modal -->
    <div id="trade-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="trade-modal-title">Trade</h2>
                <button id="close-trade-modal" class="close-modal">&times;</button>
            </div>
            <div class="trade-form-container">
                <div class="trade-type-selector">
                    <button class="trade-type-btn active" data-type="buy">Buy</button>
                    <button class="trade-type-btn" data-type="sell">Sell</button>
                </div>
                
                <div class="trade-pair-info">
                    <h3 id="trade-pair-name">-</h3>
                    <div class="trade-pair-price">
                        <span class="label">Last Price:</span>
                        <span id="trade-current-price">-</span>
                    </div>
                </div>

                <form id="trade-form" class="trade-form">
                    <div class="form-group">
                        <label for="trade-amount">Max Amount (<span id="trade-amount-currency">-</span>)</label>
                        <input type="number" id="trade-amount" name="amount" step="0.000001" min="0" required>
                        <div class="input-help">
                            <span id="trade-amount-help">Maximum amount you want to spend</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="trade-price"><span id="trade-price-label">Max Price</span> (<span id="trade-quote-currency">-</span>)</label>
                        <input type="number" id="trade-price" name="price" step="0.00000001" min="0" required>
                        <button type="button" class="use-market-price-btn" id="use-market-price">Use Market Price</button>
                        <div class="input-help">
                            <span id="trade-price-help">Maximum price for buy orders</span>
                        </div>
                    </div>

                    <div class="trade-total">
                        <span class="label">Estimated received:</span>
                        <span id="trade-total-value">0</span>
                        <span id="trade-total-currency">-</span>
                    </div>
                    
                    <div class="trade-fee-notice">
                        <span class="fee-icon">‚ÑπÔ∏è</span>
                        <span>Network Fee: <strong id="trade-fee-display">Free for 1 order, ~0.01 NXS per additional order</strong></span>
                    </div>

                    <div id="trade-error" class="trade-error" style="display: none;"></div>
                    
                    <div class="trade-actions">
                        <button type="button" id="cancel-trade" class="cancel-trade-btn">Cancel</button>
                        <button type="submit" id="find-orders-btn" class="find-orders-btn">
                            Find Available Orders
                        </button>
                    </div>
                </form>
                
                <!-- Order Review Section (hidden initially) -->
                <div id="order-review-section" class="order-review-section" style="display: none;">
                    <h3>Review Orders</h3>
                    <div id="selected-orders-list" class="selected-orders-list">
                        <!-- Selected orders will be displayed here -->
                    </div>
                    <div class="review-summary">
                        <div class="summary-row">
                            <span>Total Spending:</span>
                            <span id="review-total-spending">-</span>
                        </div>
                        <div class="summary-row">
                            <span>Average Price:</span>
                            <span id="review-avg-price">-</span>
                        </div>
                        <div class="summary-row">
                            <span>Total Received:</span>
                            <span id="review-total-received">-</span>
                        </div>
                    </div>
                    <div class="account-selection">
                        <h4>Select Accounts</h4>
                        <div class="account-selectors">
                            <div class="account-selector-group">
                                <label for="payment-account">Payment Account (From):</label>
                                <select id="payment-account" class="account-dropdown">
                                    <option value="">Loading accounts...</option>
                                </select>
                                <p class="account-helper">Account to send <span id="from-token">tokens</span> from</p>
                            </div>
                            <div class="account-selector-group">
                                <label for="receival-account">Receival Account (To):</label>
                                <select id="receival-account" class="account-dropdown">
                                    <option value="">Loading accounts...</option>
                                </select>
                                <p class="account-helper">Account to receive <span id="to-token">tokens</span> in</p>
                            </div>
                        </div>
                    </div>
                    <div class="review-actions">
                        <button type="button" id="back-to-form" class="cancel-trade-btn">Back</button>
                        <button type="button" id="execute-trade" class="execute-trade-btn">
                            Execute <span id="execute-trade-type">Trade</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../script.js"></script>
    <!-- Load DEX modules in dependency order -->
    <script src="api-config.js?v=5"></script>
    <script src="market-pairs.js?v=5"></script>
    <script src="utils.js?v=5"></script>
    <script src="state.js?v=5"></script>
    <script src="auth.js?v=5"></script>
    <script src="api.js?v=5"></script>
    <script src="renderers.js?v=5"></script>
    <script src="event-handlers.js?v=5"></script>
    <script src="chart.js?v=5"></script>
    <script src="trade.js?v=5"></script>
    <script src="dex.js?v=5"></script>
</body>
</html>
