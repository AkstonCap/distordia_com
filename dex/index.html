<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Distordia DEX - UX for the Nexus blockchain decentralized exchange">
    <title>Distordia DEX | Nexus Marketplace</title>
    <link rel="icon" type="image/png" href="../images/logo-utentekst.png">
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="dex.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="logo">
                <a href="../index.html" style="display: flex; align-items: center; gap: 0.8rem; text-decoration: none;">
                    <img src="../images/logo-utentekst.png" alt="Distordia Logo" class="logo-img">
                    <span class="logo-text">DISTORDIA</span>
                </a>
            </div>
            <ul class="nav-links">
                <li><a href="../index.html">Home</a></li>
                <li><a href="../index.html#about">About</a></li>
                <li><a href="../index.html#research">Research</a></li>
                <li><a href="index.html" class="active">DEX</a></li>
                <li><a href="../products/index.html">Products</a></li>
                <li><a href="../index.html#contact">Contact</a></li>
            </ul>
            <div class="auth-controls">
                <button id="connectWalletBtn" class="connect-wallet-btn">Connect Wallet</button>
                <div id="walletInfo" class="wallet-info" style="display: none;">
                    <span id="walletAddress" class="wallet-address"></span>
                    <button id="disconnectBtn" class="disconnect-btn">Disconnect</button>
                </div>
            </div>
            <div class="menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Trading Interface -->
    <section class="trading-section">
        <div class="container-fluid">
            <div class="trading-grid">
                <!-- Market Pairs List -->
                <div class="market-pairs-panel">
                    <div class="panel-header">
                        <h3>Market Pairs</h3>
                        <div class="search-box">
                            <input type="text" id="pair-search" placeholder="Search pairs...">
                        </div>
                    </div>
                    <div class="pairs-tabs">
                        <button class="tab-btn active" data-filter="all">All</button>
                        <button class="tab-btn" data-filter="nxs">NXS</button>
                        <button class="tab-btn" data-filter="usdd">USDD</button>
                        <button class="tab-btn" data-filter="favorites">‚òÖ</button>
                    </div>
                    <div class="pairs-list" id="pairs-list">
                        <!-- Market pairs will be loaded here -->
                        <div class="loading-spinner">Loading markets...</div>
                    </div>
                </div>

                <!-- Trading Chart -->
                <div class="chart-panel">
                    <div class="panel-header">
                        <div class="current-pair">
                            <h2 id="current-pair-name">Select a trading pair</h2>
                            <div class="pair-stats">
                                <span class="current-price" id="current-price">-</span>
                                <span class="price-change" id="price-change">-</span>
                            </div>
                        </div>
                        <div class="chart-controls">
                            <button id="trade-btn" class="trade-btn" style="display: none;">
                                <span class="trade-btn-text"><span class="trade-icon">üí±</span> Trade</span>
                            </button>
                            <button class="chart-interval" data-interval="1d">1D</button>
                            <button class="chart-interval" data-interval="1w">1W</button>
                            <button class="chart-interval" data-interval="1m">1M</button>
                            <button class="chart-interval active" data-interval="1y">1Y</button>
                            <div class="chart-divider"></div>
                            <button class="chart-scale-toggle" id="scale-toggle">Log</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="price-chart"></canvas>
                    </div>
                </div>

                <!-- Order Book -->
                <div class="orderbook-panel">
                    <div class="panel-header">
                        <h3>Order Book</h3>
                        <div class="orderbook-controls">
                            <button class="orderbook-view active" data-view="both">
                                <span class="icon">üìä</span>
                            </button>
                            <button class="orderbook-view" data-view="asks">
                                <span class="icon">üìà</span>
                            </button>
                            <button class="orderbook-view" data-view="bids">
                                <span class="icon">üìâ</span>
                            </button>
                        </div>
                    </div>
                    <div class="orderbook-content">
                        <div class="orderbook-header">
                            <span>Price</span>
                            <span>Amount</span>
                            <span>Total</span>
                        </div>
                        <div class="orderbook-asks" id="orderbook-asks">
                            <!-- Asks will be loaded here -->
                        </div>
                        <div class="orderbook-spread">
                            <span class="spread-label">Spread:</span>
                            <span class="spread-value" id="spread-value">-</span>
                        </div>
                        <div class="orderbook-bids" id="orderbook-bids">
                            <!-- Bids will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Recent Trades -->
    <section class="trades-section">
        <div class="container">
            <div class="panel-header">
                <h3>Recent Trades</h3>
                <div class="trade-filters">
                    <button class="filter-btn active" data-filter="all">All Trades</button>
                    <button class="filter-btn" data-filter="buys">Buys</button>
                    <button class="filter-btn" data-filter="sells">Sells</button>
                </div>
            </div>
            <div class="trades-table-container">
                <table class="trades-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Pair</th>
                            <th>Type</th>
                            <th>Price</th>
                            <th>Amount</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="trades-list">
                        <tr>
                            <td colspan="6" class="loading-cell">Loading recent trades...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Market Overview -->
    <section class="market-overview">
        <div class="container">
            <h2 class="section-title">Market Overview</h2>
            <div class="markets-grid" id="markets-grid">
                <!-- Market cards will be loaded here -->
                <div class="loading-spinner">Loading market data...</div>
            </div>
        </div>
    </section>

    <!-- API Status -->
    <section class="api-status">
        <div class="container">
            <div class="status-card">
                <div class="status-indicator">
                    <span class="status-dot" id="api-status-dot"></span>
                    <span class="status-text" id="api-status-text">Connecting to Nexus.io...</span>
                </div>
                <div class="status-details">
                    <span>Last Update: <span id="last-update">-</span></span>
                    <span>Block Height: <span id="status-block-height">-</span></span>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="../images/logo-utentekst.png" alt="Distordia Logo" class="footer-logo-img">
                    <span class="footer-logo-text">DISTORDIA</span>
                </div>
                <p>&copy; 2025 Distordia Labs. All rights reserved.</p>
                <p class="disclaimer">This DEX interface displays real-time market data from Nexus.io blockchain. No data is stored on this website or any centralized servers.</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login to Nexus</h2>
                <button id="close-modal" class="close-modal">&times;</button>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password">
                </div>
                <div class="form-group">
                    <label for="pin">PIN</label>
                    <input type="password" id="pin" name="pin" required autocomplete="off" inputmode="numeric">
                </div>
                <div id="login-error" class="login-error" style="display: none;"></div>
                <button type="submit" class="login-submit-btn">Login</button>
            </form>
            <div class="login-info">
                <p><small>Your session will automatically expire after 3 minutes of inactivity.</small></p>
                <p><small>Credentials are sent directly to the Nexus node and not stored.</small></p>
            </div>
        </div>
    </div>

    <!-- Trade Modal -->
    <div id="trade-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="trade-modal-title">Trade</h2>
                <button id="close-trade-modal" class="close-modal">&times;</button>
            </div>
            <div class="trade-form-container">
                <div class="trade-type-selector">
                    <button class="trade-type-btn active" data-type="buy">Buy</button>
                    <button class="trade-type-btn" data-type="sell">Sell</button>
                </div>
                
                <div class="trade-pair-info">
                    <h3 id="trade-pair-name">-</h3>
                    <div class="trade-pair-price">
                        <span class="label">Last Price:</span>
                        <span id="trade-current-price">-</span>
                    </div>
                </div>

                <form id="trade-form" class="trade-form">
                    <div class="form-group">
                        <label for="trade-amount">Max Amount (<span id="trade-amount-currency">-</span>)</label>
                        <input type="number" id="trade-amount" name="amount" step="0.000001" min="0" required>
                        <div class="input-help">
                            <span id="trade-amount-help">Maximum amount you want to spend</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="trade-price"><span id="trade-price-label">Max Price</span> (<span id="trade-quote-currency">-</span>)</label>
                        <input type="number" id="trade-price" name="price" step="0.00000001" min="0" required>
                        <button type="button" class="use-market-price-btn" id="use-market-price">Use Market Price</button>
                        <div class="input-help">
                            <span id="trade-price-help">Maximum price for buy orders</span>
                        </div>
                    </div>

                    <div class="trade-total">
                        <span class="label">Estimated received:</span>
                        <span id="trade-total-value">0</span>
                        <span id="trade-total-currency">-</span>
                    </div>
                    
                    <div class="trade-fee-notice">
                        <span class="fee-icon">‚ÑπÔ∏è</span>
                        <span>Trading Fee: <strong>1 DIST</strong> token per transaction</span>
                    </div>

                    <div id="trade-error" class="trade-error" style="display: none;"></div>
                    
                    <div class="trade-actions">
                        <button type="button" id="cancel-trade" class="cancel-trade-btn">Cancel</button>
                        <button type="submit" id="find-orders-btn" class="find-orders-btn">
                            Find Available Orders
                        </button>
                    </div>
                </form>
                
                <!-- Order Review Section (hidden initially) -->
                <div id="order-review-section" class="order-review-section" style="display: none;">
                    <h3>Review Orders</h3>
                    <div id="selected-orders-list" class="selected-orders-list">
                        <!-- Selected orders will be displayed here -->
                    </div>
                    <div class="review-summary">
                        <div class="summary-row">
                            <span>Total Spending:</span>
                            <span id="review-total-spending">-</span>
                        </div>
                        <div class="summary-row">
                            <span>Average Price:</span>
                            <span id="review-avg-price">-</span>
                        </div>
                        <div class="summary-row">
                            <span>Total Received:</span>
                            <span id="review-total-received">-</span>
                        </div>
                    </div>
                    <div class="review-actions">
                        <button type="button" id="back-to-form" class="cancel-trade-btn">Back</button>
                        <button type="button" id="execute-trade" class="execute-trade-btn">
                            Execute <span id="execute-trade-type">Trade</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../script.js"></script>
    <!-- Load DEX modules in dependency order -->
    <script src="api-config.js?v=5"></script>
    <script src="market-pairs.js?v=5"></script>
    <script src="utils.js?v=5"></script>
    <script src="state.js?v=5"></script>
    <script src="auth.js?v=5"></script>
    <script src="api.js?v=5"></script>
    <script src="renderers.js?v=5"></script>
    <script src="event-handlers.js?v=5"></script>
    <script src="chart.js?v=5"></script>
    <script src="trade.js?v=5"></script>
    <script src="dex.js?v=5"></script>
</body>
</html>
